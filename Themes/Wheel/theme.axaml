<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Retromind.ViewModels"
             xmlns:vlc="clr-namespace:LibVLCSharp.Avalonia;assembly=LibVLCSharp.Avalonia"
             xmlns:helpers="using:Retromind.Helpers"
             x:DataType="vm:BigModeViewModel"
             x:Name="BigModeRoot"
             Background="Black">

    <UserControl.Styles>
        <!-- ... Styles bleiben unverÃ¤ndert ... -->
        <Style Selector="ListBoxItem">
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Transitions">
                <Transitions>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.25" Easing="CubicEaseOut"/>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.25" Easing="CubicEaseOut"/>
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="ListBoxItem TextBlock">
            <Setter Property="Foreground" Value="#CCCCCC" /> 
        </Style>
        <Style Selector="ListBoxItem:selected TextBlock">
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Effect" Value="drop-shadow(0 0 8 #FFD700)" />
        </Style>
        <Style Selector="ListBoxItem:selected > Panel > TextBlock[IsVisible=True]">
             <Setter Property="Foreground" Value="#FFD700" />
        </Style>
        <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
        </Style>
    </UserControl.Styles>
    
    <Panel>
        <!-- LAYER 1: Hintergrund -->
        <Image Name="WallpaperImage"
               helpers:AsyncImageHelper.Url="{Binding SelectedItem.PrimaryWallpaperPath}"
               Stretch="UniformToFill" Opacity="0.15" />
        
        <!-- LAYER 2: Das Wheel -->
        <ListBox ItemsSource="{Binding Items}"
                 SelectedItem="{Binding SelectedItem}"
                 Background="Transparent"
                 AutoScrollToSelectedItem="True"
                 SelectedIndex="{Binding SelectedItemIndex, Mode=OneWayToSource}"
                 ClipToBounds="False"
                 VerticalAlignment="Stretch" HorizontalAlignment="Left"
                 Width="450">
            
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <helpers:WheelPanel WheelRadius="500" 
                                        ItemSpacingAngle="18"
                                        helpers:WheelPanel.OffsetX="225"
                                        helpers:WheelPanel.SelectedItemIndex="{Binding $parent[ListBox].SelectedIndex}"/>
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>

            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Panel Width="300" Height="140">
                         <Image helpers:AsyncImageHelper.Url="{Binding PrimaryLogoPath}" Stretch="Uniform"
                               IsVisible="{Binding PrimaryLogoPath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                        <TextBlock Text="{Binding Title}" FontSize="32" FontWeight="Bold"
                                   TextWrapping="Wrap" TextAlignment="Center" VerticalAlignment="Center"
                                   IsVisible="{Binding PrimaryLogoPath, Converter={x:Static StringConverters.IsNullOrEmpty}}"/>
                    </Panel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
        
        <!-- LAYER 3: Der rechte Inhalt -->
        <Grid ColumnDefinitions="*" RowDefinitions="*, Auto" Margin="450,0,0,0">
            <!-- METADATEN -->
            <ScrollViewer Grid.Row="0" Margin="40, 60, 60, 20" VerticalScrollBarVisibility="Auto"
                          VerticalAlignment="Stretch">
                <StackPanel>
                    <TextBlock Text="{Binding SelectedItem.Title}" FontSize="48" FontWeight="Bold" Foreground="White"
                               TextWrapping="Wrap"/>
                    <TextBlock Text="{Binding SelectedItem.Description}" FontSize="18" Foreground="#DDFFFFFF" 
                               TextWrapping="Wrap" Margin="0,20,0,0"/>
                </StackPanel>
            </ScrollViewer>
            
            <!-- MEDIEN -->
            <Panel Grid.Row="1" Margin="40,20,60,60">
               
                <!-- VIDEO SLOT (nur Platzhalter, echte VideoView kommt aus dem Host) -->
                <Border x:Name="VideoSlot"
                        Width="854" Height="480"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Bottom"
                        Background="Transparent" />
                
                <!-- COVER (wird zuletzt gezeichnet, liegt also VORNE) -->
                <Border HorizontalAlignment="Left" VerticalAlignment="Bottom" 
                        Margin="900, 0, 0, 100"> <!-- Weiter nach rechts verschoben -->
                    <Image helpers:AsyncImageHelper.Url="{Binding SelectedItem.PrimaryCoverPath}"
                           Width="280" Height="380" Stretch="Uniform"/>
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="30" OffsetX="0" OffsetY="0" Color="Black" Opacity="0.7"/>
                    </Border.Effect>
                </Border>
            </Panel>
        </Grid>
    </Panel>
</UserControl>