<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Retromind.ViewModels"
             xmlns:ext="clr-namespace:Retromind.Extensions"
             xmlns:helpers="using:Retromind.Helpers"
             x:DataType="vm:BigModeViewModel"
             Background="Black"

             ext:ThemeProperties.Name="Arcade"
             ext:ThemeProperties.Author="PLACEHOLDER_AUTHOR"
             ext:ThemeProperties.Version="0.1.0">

    <UserControl.Resources>
        <!-- Converter to load theme-local images (e.g. Images/cabinet.png, Images/pointer.png) -->
        <helpers:ThemeAssetToBitmapConverter x:Key="ThemeAssetConverter" />
        <!-- Converter to load absolute/relative file paths into Bitmaps (used for item/node assets) -->
        <helpers:PathToBitmapConverter x:Key="PathToBitmapConverter" />
        <!-- Opacity helper for pointer visibility -->
        <helpers:BoolToOpacityConverter x:Key="BoolToOpacity" TrueOpacity="1.0" FalseOpacity="0.0" />
    </UserControl.Resources>

    <UserControl.Styles>
        <!-- Base style for items in the game list -->
        <Style Selector="ListBoxItem">
            <Setter Property="Padding" Value="4"/>
            <Setter Property="Margin" Value="0,2"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0,0,0,0"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
        </Style>

        <!-- Selected item: slight background highlight -->
        <Style Selector="ListBoxItem:selected">
            <Setter Property="Background" Value="#40FFFFFF"/>
        </Style>
    </UserControl.Styles>

    <Grid>
        <!-- Background: dark -->
        <Rectangle Fill="#101015"/>

        <!-- Main layout: cabinet area (left) + game list (right) -->
        <Grid ColumnDefinitions="3*,2*" Margin="40,30,40,30">

            <!-- LEFT: Arcade cabinet area -->
            <Grid Grid.Column="0"
                  ColumnDefinitions="Auto"
                  RowDefinitions="Auto,*">

                <!-- Optional: title as fallback if no marquee/logo is available -->
                <TextBlock Grid.Row="0"
                           Text="{Binding SelectedItem.Title}"
                           FontSize="28"
                           FontWeight="Bold"
                           Foreground="#FFFFFF"
                           Margin="0,0,0,8"
                           TextTrimming="CharacterEllipsis"
                           IsVisible="{Binding IsGameListActive}"/>

                <!-- Cabinet composition -->
                <Grid Grid.Row="1">
                    <!-- Overlay grid: logical slots for marquee, bezel/screen and control panel.
                             These are rendered first, so the cabinet image can sit visually on top. -->
                    <Grid Margin="0"
                          RowDefinitions="Auto,Auto,Auto"
                          HorizontalAlignment="Center">

                        <!-- Marquee row -->
                        <Border Grid.Row="0"
                                Width="730"
                                Height="180"
                                Margin="-180,15,0,10"
                                Background="Transparent"
                                ClipToBounds="True">
                            <Image Source="{Binding ActiveMarqueePath,
                                                    Converter={StaticResource PathToBitmapConverter}}"
                                   Stretch="UniformToFill"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding ActiveMarqueePath, Converter={x:Static helpers:StringConverters.IsNotNullOrEmpty}}"/>
                        </Border>

                        <!-- Screen row: bezel + video slot -->
                        <Border Grid.Row="1"
                                Width="660"
                                Height="480"
                                Margin="-175,85,0,10"
                                Background="Transparent"
                                ClipToBounds="True">
                            <Grid>
                                <!-- Bezel artwork (item/node) -->
                                <Image Source="{Binding ActiveBezelPath,
                                                        Converter={StaticResource PathToBitmapConverter}}"
                                       Stretch="UniformToFill"
                                       HorizontalAlignment="Stretch"
                                       VerticalAlignment="Stretch"
                                       IsVisible="{Binding ActiveBezelPath, Converter={x:Static helpers:StringConverters.IsNotNullOrEmpty}}"/>

                                <!-- Video area: this slot is used by the host for the preview video.
                                     Sized and positioned to sit inside the cabinet screen. -->
                                <Border x:Name="VideoSlot"
                                        Width="550"
                                        Height="330"
                                        Margin="0,-30,0,0"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        CornerRadius="12"
                                        Background="#202020"
                                        BorderBrush="#505050"
                                        BorderThickness="2"
                                        ClipToBounds="True">
                                    <TextBlock Text="Preview"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Foreground="#404040"
                                               FontSize="20" />
                                </Border>
                            </Grid>
                        </Border>
                    </Grid>
                    
                    <!-- Base cabinet artwork from the theme directory (drawn on top).
                             The cabinet PNG should have transparent openings for marquee,
                             screen and control panel so the inner content remains visible. -->
                    <Image Source="{Binding Converter={StaticResource ThemeAssetConverter},
                                                ConverterParameter=Images/cabinet.png}"
                           Stretch="Uniform"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           IsHitTestVisible="False"/>
                </Grid>
                
                <!-- Control panel row -->
                <Border Grid.Row="1"
                        Width="1200"
                        Height="200"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Bottom"
                        Margin="-150,0,0,10"
                        Background="Transparent">
                    <!-- <Border.Clip>
                        <PathGeometry Figures="M200,0 L600,0 L620,120 L180,120 Z" />
                    </Border.Clip> -->

                    <Image Source="{Binding ActiveControlPanelPath,
                                                    Converter={StaticResource PathToBitmapConverter}}"
                           Stretch="Uniform"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           IsVisible="{Binding ActiveControlPanelPath, Converter={x:Static helpers:StringConverters.IsNotNullOrEmpty}}"/>
                </Border>
            </Grid>

            <!-- RIGHT: Game logo list with pointer -->
            <Border Grid.Column="1"
                    Background="#22000000"
                    CornerRadius="10"
                    Padding="12">
                <ListBox ItemsSource="{Binding Items}"
                         SelectedItem="{Binding SelectedItem}"
                         Background="Transparent"
                         BorderThickness="0"
                         AutoScrollToSelectedItem="True">

                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid Height="72"
                                  Margin="0,4"
                                  ColumnDefinitions="Auto,*,Auto">
                                
                                <!-- Game logo (if present) -->
                                <Image Grid.Column="0"
                                       helpers:AsyncImageHelper.Url="{Binding PrimaryLogoPath}"
                                       Width="140"
                                       Stretch="Uniform"
                                       IsVisible="{Binding PrimaryLogoPath, Converter={x:Static helpers:StringConverters.IsNotNullOrEmpty}}"/>

                                <!-- Fallback: title text if no logo -->
                                <TextBlock Grid.Column="1"
                                           Text="{Binding Title}"
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center"
                                           Foreground="White"
                                           FontSize="18"
                                           TextTrimming="CharacterEllipsis"
                                           IsVisible="{Binding PrimaryLogoPath, Converter={x:Static helpers:StringConverters.IsNullOrEmpty}}"/>

                                <!-- Pointer graphic on the right, bound to selection -->
                                <Image Grid.Column="2"
                                       Source="{Binding Converter={StaticResource ThemeAssetConverter},
                                                        ConverterParameter=Images/pointer.png}"
                                       Width="40"
                                       HorizontalAlignment="Left"
                                       VerticalAlignment="Center"
                                       Opacity="{Binding $parent[ListBoxItem].IsSelected, Converter={StaticResource BoolToOpacity}}"/>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Border>
        </Grid>

        <!-- Bottom info bar (year, developer, game counter) -->
        <Border VerticalAlignment="Bottom"
                Margin="40,0,40,20"
                CornerRadius="6"
                Background="#66000000"
                Padding="10,6">
            <Grid ColumnDefinitions="*,*,Auto">

                <!-- Left: Year + Developer -->
                <StackPanel Grid.Column="0"
                            Orientation="Horizontal"
                            HorizontalAlignment="Left"
                            Spacing="8">
                    <TextBlock FontSize="14"
                               Foreground="#CCFFFFFF"
                               Text="{Binding SelectedYear}"/>
                    <TextBlock FontSize="14"
                               Foreground="#CCFFFFFF"
                               Text="{Binding SelectedDeveloper}"
                               TextTrimming="CharacterEllipsis"
                               Margin="8,0,0,0"/>
                </StackPanel>

                <!-- Right: Game counter -->
                <StackPanel Grid.Column="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Spacing="4">
                    <TextBlock FontSize="14"
                               Foreground="#88FFFFFF"
                               Text="Game:"/>
                    <TextBlock FontSize="14"
                               Foreground="#CCFFFFFF"
                               Text="{Binding CurrentGameNumber}"/>
                    <TextBlock FontSize="14"
                               Foreground="#88FFFFFF"
                               Text="/"/>
                    <TextBlock FontSize="14"
                               Foreground="#CCFFFFFF"
                               Text="{Binding TotalGames}"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>