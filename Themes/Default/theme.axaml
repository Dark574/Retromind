<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Retromind.ViewModels"
             xmlns:ext="clr-namespace:Retromind.Extensions"
             xmlns:helpers="using:Retromind.Helpers"
             x:DataType="vm:BigModeViewModel"
             Background="#111319"

             ext:ThemeProperties.Name="Default"
             ext:ThemeProperties.Author="Retromind"
             ext:ThemeProperties.Version="0.2.0"
             ext:ThemeProperties.VideoEnabled="True"
             ext:ThemeProperties.SelectedScale="1.05"
             ext:ThemeProperties.UnselectedOpacity="0.65"
             ext:ThemeProperties.SelectedGlowOpacity="0.45"
             ext:ThemeProperties.FadeDurationMs="220"
             ext:ThemeProperties.MoveDurationMs="220"
             ext:ThemeProperties.PanelPadding="32"
             ext:ThemeProperties.TitleFontSize="46"
             ext:ThemeProperties.BodyFontSize="18">

    <UserControl.Resources>
        <!-- Soft slide+fade animation for the main title -->
        <Transitions x:Key="TitleTransitions">
            <DoubleTransition Property="{x:Static Visual.OpacityProperty}"
                              Duration="0:0:0.80" />
            <TransformOperationsTransition Property="{x:Static Visual.RenderTransformProperty}"
                                           Duration="0:0:0.80" />
        </Transitions>

        <!-- Slightly slower slide+fade for the cover overlay -->
        <Transitions x:Key="CoverTransitions">
            <DoubleTransition Property="{x:Static Visual.OpacityProperty}"
                              Duration="0:0:0.70" />
            <TransformOperationsTransition Property="{x:Static Visual.RenderTransformProperty}"
                                           Duration="0:0:0.70" />
        </Transitions>
    </UserControl.Resources>

    <!-- Two-column layout: left = text/list, right = video + cover -->
    <Grid ColumnDefinitions="0.38*,0.62*"
          Margin="40,30">
        <!-- LEFT COLUMN: category, big title, game list -->
        <Border Grid.Column="0"
                Background="#20232A"
                CornerRadius="8"
                Padding="28,32,24,28">
            <Grid RowDefinitions="Auto,Auto,*">
                <!-- Category / genre label -->
                <TextBlock Grid.Row="0"
                           Text="{Binding CategoryTitle}"
                           FontSize="18"
                           FontWeight="SemiBold"
                           Foreground="#7BA3FF"
                           Margin="0,0,0,12"
                           TextTrimming="CharacterEllipsis" />

                <!-- Big title of the selected game -->
                <Border Grid.Row="1"
                        Margin="0,0,0,24">
                    <TextBlock Text="{Binding SelectedItem.Title}"
                               FontSize="42"
                               FontWeight="Bold"
                               Foreground="White"
                               TextWrapping="Wrap"
                               MaxLines="2"
                               TextTrimming="CharacterEllipsis">
                        <TextBlock.RenderTransform>
                            <TranslateTransform X="-40" />
                        </TextBlock.RenderTransform>
                        <TextBlock.Transitions>
                            <StaticResource ResourceKey="TitleTransitions" />
                        </TextBlock.Transitions>
                    </TextBlock>
                </Border>

                <!-- ROW 2: entweder Kategorien oder Spiele, je nach Modus -->

                <!-- Kategorien-Liste (z.B. Bibliothek: Spiele / Filme, oder Spiele: SNES / C64 ...) -->
                <ListBox Grid.Row="2"
                         ItemsSource="{Binding CurrentCategories}"
                         SelectedItem="{Binding SelectedCategory}"
                         Background="Transparent"
                         BorderThickness="0"
                         Padding="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         IsVisible="{Binding IsCategorySelectionActive}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}"
                                       FontSize="16"
                                       Margin="0,3"
                                       Foreground="White"
                                       TextTrimming="CharacterEllipsis" />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Spiele-Liste (wie bisher) -->
                <ListBox Grid.Row="2"
                         ItemsSource="{Binding Items}"
                         SelectedItem="{Binding SelectedItem}"
                         Background="Transparent"
                         BorderThickness="0"
                         Padding="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         IsVisible="{Binding IsGameListActive}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Title}"
                                       FontSize="16"
                                       Margin="0,3"
                                       Foreground="White"
                                       TextTrimming="CharacterEllipsis" />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </Border>

        <!-- RIGHT COLUMN: video background + cover overlay -->
        <Grid Grid.Column="1"
              Margin="28,0,0,0">
            <Border Background="#181A20"
                    CornerRadius="8"
                    Padding="16"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch">
                <!-- Two columns: cover (auto) + video (*) -->
                <Grid ColumnDefinitions="Auto,*">
                    <!-- Game cover: separate column so it is not under the video overlay -->
                    <Border Grid.Column="0"
                            Width="260"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            Margin="0,0,16,0"
                            Background="#00000000"
                            Opacity="0.0">
                        <!-- Start a bit more to the left; transition slides it in -->
                        <Border.RenderTransform>
                            <TranslateTransform X="-32" />
                        </Border.RenderTransform>
                        <Border.Transitions>
                            <StaticResource ResourceKey="CoverTransitions" />
                        </Border.Transitions>

                        <Image helpers:AsyncImageHelper.Url="{Binding SelectedItem.PrimaryCoverPath}"
                               Stretch="UniformToFill"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center" />
                    </Border>

                    <!-- VideoSlot used by the BigMode host to place the VLC overlay -->
                    <Border Grid.Column="1"
                            x:Name="VideoSlot"
                            Background="Black"
                            CornerRadius="4"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            MinWidth="640"
                            MinHeight="360" />
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>